<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}" dir="{{ default `ltr` .Language.LanguageDirection }}">
    <head>
        {{- partial "head/head.html" . -}}
        {{- block "head" . -}}{{ end }}
    </head>
    <body class="{{ block `body-class` . }}{{ end }} has-header">
        {{- partial "head/colorScheme" . -}}

        <!-- Top header navigation like dev.to -->
        <header class="top-header">
            <div class="header-inner">
                <div class="header-left">
                    {{ with .Site.Params.sidebar.avatar }}
                        {{ if (default true .enabled) }}
                        <a href="{{ $.Site.BaseURL | relLangURL }}" class="header-logo">
                            {{ if not .local }}
                                <img src="{{ .src }}" width="40" height="40" alt="Logo">
                            {{ else }}
                                {{ $avatar := resources.Get (.src) }}
                                {{ if $avatar }}
                                    {{ $avatarResized := $avatar.Resize "80x" }}
                                    <img src="{{ $avatarResized.RelPermalink }}" width="40" height="40" alt="Logo">
                                {{ end }}
                            {{ end }}
                        </a>
                        {{ end }}
                    {{ end }}
                    <a href="{{ .Site.BaseURL | relLangURL }}" class="header-title">{{ .Site.Title }}</a>
                </div>

                <nav class="header-nav">
                    {{ $currentPage := . }}
                    {{ range .Site.Menus.main }}
                        {{ $active := or (eq $currentPage.RelPermalink .URL) (or ($currentPage.HasMenuCurrent "main" .) ($currentPage.IsMenuCurrent "main" .)) }}
                        <a href='{{ .URL }}' class="nav-link {{ if $active }}active{{ end }}" {{ if eq .Params.newTab true }}target="_blank"{{ end }}>
                            {{ $icon := default .Pre .Params.Icon }}
                            {{ with $icon }}
                                {{ partial "helper/icon" . }}
                            {{ end }}
                            <span>{{- .Name -}}</span>
                        </a>
                    {{ end }}
                </nav>

                <div class="header-right">
                    {{- with .Site.Menus.social -}}
                        {{ range . }}
                            <a
                                href='{{ .URL }}'
                                class="social-link"
                                {{ if eq (default true .Params.newTab) true }}target="_blank"{{ end }}
                                {{ with .Name }}title="{{ . }}"{{ end }}
                                rel="me"
                            >
                                {{ $icon := default "link" .Params.Icon }}
                                {{ with $icon }}
                                    {{ partial "helper/icon" . }}
                                {{ end }}
                            </a>
                        {{ end }}
                    {{- end -}}
                </div>
            </div>
        </header>

        <div class="container main-container flex on-phone--column compact header-layout">
            <main class="main full-width">
                {{- block "main" . }}{{- end }}
            </main>
            {{- block "right-sidebar" . -}}{{ end }}
        </div>
        {{ partial "footer/include.html" . }}

        {{/* GSpeech voice reading plugin - only on posts with voice: true */}}
        {{ if and .IsPage (eq .Section "post") .Params.voice }}
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        <script src="https://widget.gspeech.io/b31effc078986d38705e22136b71b070?v=4"></script>
        {{ end }}

        {{/* Goatcounter analytics (proxied to avoid ad blockers) */}}
        <script data-goatcounter="https://gantz.ai/gc/count" async src="https://gantz.ai/gc/count.js"></script>

        {{/* Load view counts for all posts on page */}}
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.view-count[data-path]').forEach(function(el) {
                var path = el.getAttribute('data-path');
                fetch('https://gantz.ai/gc/counter' + path + '.json')
                    .then(function(r) { return r.json(); })
                    .then(function(data) { el.textContent = data.count || '0'; })
                    .catch(function() { el.textContent = '0'; });
            });
        });
        </script>
    </body>
</html>
