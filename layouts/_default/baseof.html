<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}" dir="{{ default `ltr` .Language.LanguageDirection }}">
    <head>
        {{- partial "head/head.html" . -}}
        {{- block "head" . -}}{{ end }}
    </head>
    <body class="{{ block `body-class` . }}{{ end }}">
        {{- partial "head/colorScheme" . -}}

        {{/* The container is wider when there's any activated widget */}}
        {{- $hasWidget := false -}}
        {{- range .Site.Params.widgets -}}
            {{- if gt (len .) 0 -}}
                {{- $hasWidget = true -}}
            {{- end -}}
        {{- end -}}
        <div class="container main-container flex on-phone--column {{ if $hasWidget }}extended{{ else }}compact{{ end }}">
            {{- block "left-sidebar" . -}}
                {{ partial "sidebar/left.html" . }}
            {{- end -}}
            {{- block "right-sidebar" . -}}{{ end }}
            <main class="main full-width">
                {{- block "main" . }}{{- end }}
            </main>
        </div>
        {{ partial "footer/include.html" . }}

        {{/* GSpeech voice reading plugin - only on posts with voice: true */}}
        {{ if and .IsPage (eq .Section "post") .Params.voice }}
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        <script src="https://widget.gspeech.io/b31effc078986d38705e22136b71b070?v=4"></script>
        {{ end }}

        {{/* Goatcounter analytics (proxied to avoid ad blockers) */}}
        <script data-goatcounter="https://gantz.ai/gc/count" async src="https://gantz.ai/gc/count.js"></script>

        {{/* Load view counts for all posts on page */}}
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.view-count[data-path]').forEach(function(el) {
                var path = el.getAttribute('data-path');
                fetch('https://gantz.ai/gc/counter' + path + '.json')
                    .then(function(r) { return r.json(); })
                    .then(function(data) { el.textContent = data.count || '0'; })
                    .catch(function() { el.textContent = '0'; });
            });
        });
        </script>
    </body>
</html>
