{{- $context := .Context -}}
{{- $limit := default 5 .Params.limit -}}
{{- $pages := where $context.Site.RegularPages "Type" "in" $context.Site.Params.mainSections -}}
{{- $featured := where $pages "Params.featured" true -}}

{{- if $featured -}}
<section class="widget archives">
    <div class="widget-icon">
        {{ partial "helper/icon" "hash" }}
    </div>
    <h2 class="widget-title section-title">Featured</h2>

    <div class="featured-posts-list">
        {{ range first $limit $featured }}
        <a href="{{ .RelPermalink }}" class="featured-post-item">
            {{ with .Params.image }}
                {{ $imgPath := . }}
                {{/* Handle both .webp and .png extensions */}}
                {{ $img := resources.Get $imgPath }}
                {{ if not $img }}
                    {{ $imgPath = replace $imgPath ".webp" ".png" }}
                    {{ $img = resources.Get $imgPath }}
                {{ end }}
                {{ if $img }}
                    {{ $thumb := $img.Resize "120x90 q80" }}
                    <img src="{{ $thumb.RelPermalink }}" width="60" height="45" alt="{{ $.Title }}" loading="lazy">
                {{ end }}
            {{ end }}
            <span class="featured-post-title">{{ .Title | truncate 40 }}</span>
        </a>
        {{ end }}
    </div>
</section>

<style>
.featured-posts-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}
.featured-post-item {
    display: flex;
    align-items: center;
    gap: 12px;
    text-decoration: none;
    color: inherit;
}
.featured-post-item img {
    width: 60px;
    height: 45px;
    object-fit: cover;
    border-radius: 6px;
    flex-shrink: 0;
}
.featured-post-title {
    font-size: 14px;
    line-height: 1.4;
    color: #333;
}
.featured-post-item:hover .featured-post-title {
    color: #0066cc;
}
</style>
{{- end -}}
